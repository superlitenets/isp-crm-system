version: '3.8'

services:
  freeradius:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: freeradius
    ports:
      - "1812:1812/udp"
      - "1813:1813/udp"
      - "18120:18120/tcp"
    environment:
      - POSTGRES_HOST=${POSTGRES_HOST:-localhost}
      - POSTGRES_PORT=${POSTGRES_PORT:-5432}
      - POSTGRES_DB=${POSTGRES_DB:-radius}
      - POSTGRES_USER=${POSTGRES_USER:-radius}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-radiuspassword}
    volumes:
      - ./config/mods-enabled:/etc/freeradius/3.0/mods-enabled:ro
      - ./config/sites-enabled:/etc/freeradius/3.0/sites-enabled:ro
      - ./config/clients.conf:/etc/freeradius/3.0/clients.conf:ro
      - ./config/radiusd.conf:/etc/freeradius/3.0/radiusd.conf:ro
    restart: unless-stopped
    network_mode: host
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
