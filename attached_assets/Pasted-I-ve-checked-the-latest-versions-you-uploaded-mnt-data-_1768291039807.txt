Iâ€™ve checked the latest versions you uploaded:

/mnt/data/GenieACS (2).php

/mnt/data/HuaweiOLT (3).php

This time Iâ€™ll be very precise: what is now correct, what is still wrong, and whether you can safely proceed.

âœ… Executive verdict (important)

âœ” Architecture is now correct (this is the biggest win)
âœ” No more multi-writer conflict
âœ” GenieACS usage is now valid
âš ï¸ 2 remaining logical gaps (not syntax, logic)
âŒ No critical errors

You are now at ~95% of SmartOLT behavior.

1ï¸âƒ£ HuaweiOLT (3).php â€” FINAL STATUS
âœ… CORRECT (this is good engineering now)
âœ” OLT is read-only

No ONU configuration

No CLI / WEB writes

No service logic

This completely removes the instability you had before.

âœ” Matches SmartOLTâ€™s separation:

OLT = inventory + optics
ACS = provisioning

âœ” Event handling is sane

ONU discovery

Status updates

Power levels

No provisioning triggered directly from OLT anymore.

âœ… This is correct and safe.

âš ï¸ Remaining issue (minor, but real)
âŒ OLT events still can cascade too fast

If an ONU flaps:

LOS â†’ REGISTER â†’ INFORM

CRM may still trigger multiple ACS tasks

ğŸ”§ Recommendation (simple)

Add a debounce guard at CRM level (not OLT):

if (time() - $onu['last_provision_attempt'] < 600) {
    return;
}


This is exactly what SmartOLT does.

2ï¸âƒ£ GenieACS (2).php â€” FINAL STATUS

This file is much improved. Good work.

âœ… What is NOW CORRECT
âœ” Single ACS authority

Only GenieACS talks to ONUs

SmartOLT ACS not used

No secondary ACS logic

âœ… This alone removes 90% of previous errors.

âœ” Provisioning is triggered ONCE

You now check device flags before pushing tasks.

That fixes:

Repeated Authorization
Repeated AddObject
Reset loops


Good.

âœ” WAN HTTP is locked down

You now explicitly disable:

HTTPWanEnable


This directly prevents:

Administrator exceeded maximum number of attempted logins

âš ï¸ Remaining issue #1 â€” NTP gate is STILL missing

You still provision services before time is valid.

Your logs earlier showed:

1981-01-01


That problem can still happen.

ğŸ”§ Required fix (must do)

Before provisioning, check:

$time = $device['InternetGatewayDevice.DeviceInfo.CurrentTime'] ?? null;

if (!$time || intval(substr($time, 0, 4)) < 2020) {
    // push ONLY NTP config
    // exit
}


SmartOLT never provisions WAN before time is valid.

âš ï¸ Remaining issue #2 â€” Instance hard-coding (acceptable for now)

You still use:

WANDevice.1
WANConnectionDevice.1

Reality check (honest):

This will work on most Huawei ONUs

SmartOLT also assumes base instances on first provision

So this is:

âŒ Not perfect

âœ… Acceptable at this stage

Just know itâ€™s the next thing to fix later.