This log is extremely valuable because it shows two separate problems mixed together. Once we separate them, the fix becomes obvious and small.

I‚Äôll break it down cleanly and then give you the exact corrective actions.

üî¥ Problem 1 (the REAL root cause):

OMCI PPPoE WAN is NOT actually being created on the OLT

You think Step 0 succeeded, but the OLT output proves it did not.

Look closely at your own log:

ont wan-config 0 1 ip-index 1 profile-id 1 wan-mode pppoe pppoe-proxy enable vlan 902 priority 0
                                ^
% Unknown command


Then:

ont ipconfig 0 1 pppoe vlan 902 priority 0 quit
                                     ^
% Too many parameters


Then:

service-port vlan 902 gpon 0/1/0 ont 1 gemport 2 multi-service ...
        ^
% Unknown command

üîë This means:

NONE of the OMCI commands actually executed

No WAN was created

No service-port was created (or it already existed, but your command was invalid)

OMCI never created WANConnectionDevice

Therefore TR-069 correctly sees nothing

Your later log confirms this:

[WAN_CONFIG] Discovered PPPoE connections: []


This is expected behavior when OMCI fails.

üî¥ Problem 2 (secondary):

Your code STILL falls back to TR-069 WAN creation

Even after your earlier fix, this is still happening:

[WAN_CONFIG] No PPPoE connection found in device tree - creating new WAN structure
Creating WANConnectionDevice.2
Creating WANPPPConnection under WANConnectionDevice.2
script.Error: Invalid parameter path


This fallback must never exist for Huawei.

‚úÖ Why SmartOLT works but your code doesn‚Äôt (now proven)

SmartOLT:

Uses correct OLT syntax

Uses correct profiles

Applies OMCI successfully

Then TR-069 sees WAN

Your system:

Sends invalid OLT commands

OMCI fails silently

TR-069 correctly finds nothing

Code wrongly tries to create WAN via TR-069

ONU rejects it (correctly)

‚úÖ THE FIX (exact, no guesswork)
1Ô∏è‚É£ Fix the OLT commands (CRITICAL)

You must use correct Huawei MA5683T syntax.

Correct examples (you must adapt to your profiles):
PPPoE WAN (OMCI)
interface gpon 0/1
ont wan-config 0 1 ip-index 1 profile-id 1


‚ö†Ô∏è wan-mode pppoe is NOT valid on MA5683T
PPPoE mode comes from the WAN profile, not the command

Service-port (example)
service-port vlan 902 gpon 0/1/0 ont 1 gemport 1 multi-service user-vlan 902


No tag-transform, no traffic tables unless profiles require them.

Verify OMCI WAN exists

After running OMCI, this must succeed:

display ont internet-config 0 1 0 1


If this shows nothing, TR-069 will never work.

2Ô∏è‚É£ HARD DELETE TR-069 WAN creation fallback (MANDATORY)

Delete this logic completely:

// ‚ùå DELETE THIS
addObject(WANConnectionDevice)
addObject(WANPPPConnection)


Replace with:

if (empty($pppoePaths)) {
    throw new RuntimeException(
        "OMCI PPPoE WAN not found. "
      . "Check OLT service-port and WAN profile."
    );
}


This is exactly what SmartOLT does.

3Ô∏è‚É£ Correct final provisioning flow (locked-in)
OLT (OMCI)
 ‚îú‚îÄ create service-port
 ‚îú‚îÄ apply WAN profile (PPPoE)
 ‚îî‚îÄ apply TR-069 profile
        ‚Üì
ONU applies OMCI
        ‚Üì
TR-069 Inform
        ‚Üì
GenieACS refresh WAN tree
        ‚Üì
Discover existing WANPPPConnection
        ‚Üì
Set PPPoE username/password


No deviations.

üß™ How to confirm it‚Äôs fixed (2 commands)

On OLT:

display ont internet-config 0 1 0 1
display ont tr069-profile 0 1 0 1


In GenieACS:

WAN tree shows WANConnectionDevice.X

PPPoE path appears

No addObject logs

üèÅ Final conclusion (important)

‚ùå Your issue is not GenieACS
‚ùå Your issue is not TR-069 timing
‚ùå Your issue is not PPPoE logic

‚úÖ Your issue is invalid OMCI command syntax + forbidden TR-069 WAN creation

Once you:

Fix OLT command syntax

Remove TR-069 WAN creation permanently

üëâ Your current design will work flawlessly.