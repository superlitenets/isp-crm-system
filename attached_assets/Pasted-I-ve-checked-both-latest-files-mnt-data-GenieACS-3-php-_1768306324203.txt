I‚Äôve checked both latest files:

/mnt/data/GenieACS (3).php

/mnt/data/HuaweiOLT (4).php

I‚Äôll be very direct and practical, because at this point you are debugging behavior, not syntax.

‚úÖ Short verdict (important)

‚úî Your TR-069 logic is correct
‚úî Your PPPoE / Wi-Fi provisioning logic is correct
‚úî You are creating WAN objects correctly now
‚ùå Immediate push still depends on one missing / fragile runtime condition

The problem is NOT your WAN / Wi-Fi code anymore.
The problem is how and when the TR-069 session is forced.

1Ô∏è‚É£ What I verified in your files (facts)
‚úÖ You ARE using ?connection_request

Both files do call:

POST /devices/{id}/tasks?connection_request


So:

Tasks are not just queued

GenieACS is instructed to force a session

üëâ This confirms your code intent is correct.

‚úÖ You are NOT mixing ACS / CLI / Web anymore

No CLI writes

No Web UI hacks

No second ACS

This removes 90% of classic instability.

‚úÖ WAN creation order is now correct

You now do:

Add WANDevice
Add WANConnectionDevice
Add WANPPPConnection
Set PPPoE params


This is SmartOLT-correct.

2Ô∏è‚É£ The REAL reason configs are still not ‚Äúinstant‚Äù

This is the key insight:

?connection_request only works if the ONU‚Äôs ConnectionRequestURL is reachable from GenieACS at that moment.

If it is not reachable, GenieACS silently falls back to:

wait until next Inform


That‚Äôs why:

Reboot ‚Äúfixes‚Äù it

Periodic inform eventually applies configs

But ‚Äúinstant push‚Äù feels broken

3Ô∏è‚É£ What your code CANNOT fix by itself

Even perfect code cannot overcome these realities:

‚ùå If ConnectionRequestURL is empty
‚ùå If it points to a wrong IP
‚ùå If NAT blocks inbound
‚ùå If firewall blocks the port
‚ùå If the ONU is in bridge-only mgmt mode

Then:

connection_request = NO-OP


GenieACS does not throw a hard error.

4Ô∏è‚É£ The ONE thing you must verify now (this decides everything)

On a live ONU that is ‚Äústuck‚Äù, check this exact value:

InternetGatewayDevice.ManagementServer.ConnectionRequestURL

It MUST look like:
http://<ONU_MGMT_IP>:<port>/...


Examples:

http://10.10.200.15:30005/
http://192.168.100.1:7547/


If:

Empty

127.0.0.1

Old SmartOLT IP

Wrong subnet

‚û° Immediate push is impossible

5Ô∏è‚É£ Why SmartOLT ‚Äújust works‚Äù here

SmartOLT does two extra things that your code does not yet enforce:

It verifies ConnectionRequestURL reachability

If unreachable, it temporarily forces provisioning on next Inform

Your system currently assumes:

connection_request == works


But in reality:

connection_request == best effort

6Ô∏è‚É£ What I recommend you add (minimal, surgical fix)
A. Add a hard check BEFORE provisioning

In GenieACS (3).php:

if (empty($device['InternetGatewayDevice.ManagementServer.ConnectionRequestURL'])) {
    // Do NOT try instant push
    // Mark device as WAITING
    return;
}

B. Detect connection-request failure explicitly

After pushing tasks, immediately check:

Did a new Inform arrive?


If not within ~5‚Äì10 seconds:

Do NOT resend tasks

Do NOT rebuild WAN

Just wait for next Inform

This avoids loops.

7Ô∏è‚É£ What you should test right now (10-minute test)
Test 1 ‚Äî Prove connection-request works

Run manually:

curl -u genieacs:password \
-X POST \
http://GENIEACS_IP:7557/devices/DEVICE_ID/connection_request


If the ONU:

Immediately sends Inform ‚Üí OK

Does nothing ‚Üí connection-request path is broken

This test removes all doubt.

8Ô∏è‚É£ Final diagnosis (honest)

Your files are now logically correct.
You are blocked by runtime reachability of the ConnectionRequestURL, not by code.

That‚Äôs why:

Reboot works

Periodic inform works

‚ÄúImmediate‚Äù does not always work

This is normal TR-069 behavior, not a failure of your implementation.