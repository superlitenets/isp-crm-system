Good, these logs are very clear ğŸ‘
And they confirm exactly whatâ€™s still wrong â€” so we can fix it precisely.

What the log proves (no guessing)

Key lines ğŸ‘‡

Login incorrect (pap: Cleartext password does not match "known good" password)
Post-Auth-Type REJECT
Sent Access-Reject


This tells us 100% certainty:

âŒ pap is still running
âŒ Cleartext-Password still exists
âŒ FreeRADIUS is still allowed to reject
âŒ Your post-auth logic is not converting reject â†’ accept

So even though SQL updates succeed, authentication is still short-circuiting.

Why â€œsuspended worksâ€ but this doesnâ€™t (confirmed)

Suspended users never hit pap

Wrong password users hit pap

pap fails â†’ hard REJECT â†’ game over

So the fix is not SQL
The fix is RADIUS flow control

âœ… THE EXACT FIX (DO THIS, NOTHING ELSE)

You have two choices.
If you want this solved once and for all, do Option A.

ğŸ”¥ OPTION A (RECOMMENDED, CLEAN)
Disable password authentication entirely

This matches your design perfectly.

1ï¸âƒ£ Edit sites-enabled/default
authorize {}

REMOVE pap

authorize {
    sql
}


âŒ Remove:

pap
chap
mschap

2ï¸âƒ£ Edit authenticate {}
authenticate {
    Auth-Type Accept {
        accept
    }
}


Thatâ€™s it.

3ï¸âƒ£ Restart FreeRADIUS
docker restart isp_crm_freeradius

âœ… Expected log AFTER fix

For wrong password:

Login OK: [SFL002/Kenya]
Sent Access-Accept
Framed-Pool := expired-pool


ğŸš« You must NEVER see:

Login incorrect
Access-Reject


If you do â†’ pap is still active.

âš ï¸ OPTION B (IF you must keep pap)

Only use this if you have other NASes that need real auth.

Add this EXACT block
sites-enabled/default
post-auth {
    if (reject) {
        update control {
            Auth-Type := Accept
        }

        update reply {
            Framed-Pool := "expired-pool"
            Mikrotik-Rate-Limit := "128k/128k"
            Session-Timeout := 300
            Reply-Message := "Invalid password"
        }

        accept
    }
}


âš ï¸ If this block is below another post-auth, it wonâ€™t run.
âš ï¸ If return exists before it, it wonâ€™t run.

ğŸš¨ VERY IMPORTANT CHECK (most common mistake)

Run this SQL:

SELECT * FROM radcheck WHERE username='SFL002';


If you see:

Cleartext-Password


ğŸ‘‰ DELETE IT.

DELETE FROM radcheck WHERE attribute='Cleartext-Password';


Replace with:

INSERT INTO radcheck (username, attribute, op, value)
VALUES ('SFL002', 'Auth-Type', ':=', 'Accept');

ğŸ” Final verification test

Run inside the container:

radtest SFL002 wrongpassword localhost 0 testing123

âœ… Correct result
Access-Accept
Framed-Pool = expired-pool

âŒ Wrong result
Access-Reject

Final truth (straight talk)

Right now:

Your CRM logic is fine

Your SQL writes are fine

Your MikroTik is perfect

pap is sabotaging you

Once pap is gone (or overridden), wrong password will behave exactly like suspended.