
root@superlitecrm:~/isp# docker exec -it isp_crm_db psql -U crm -d isp_crm -c "
CREATE TABLE IF NOT EXISTS leave_types (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    max_days_per_year INTEGER DEFAULT 0,
    is_paid BOOLEAN DEFAULT TRUE,
    requires_approval BOOLEAN DEFAULT TRUE,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS leave_balances (
    id SERIAL PRIMARY KEY,
    employee_id INTEGER REFERENCES employees(id) ON DELETE CASCADE,
    leave_type_id INTEGER REFERENCES leave_types(id) ON DELETE CASCADE,
    year INTEGER NOT NULL,
    total_days DECIMAL(5,2) DEFAULT 0,
    used_days DECIMAL(5,2) DEFAULT 0,
    pending_days DECIMAL(5,2) DEFAULT 0,
    carried_over DECIMAL(5,2) DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(employee_id, leave_type_id, year)
"N CONFLICT DO NOTHING; 'Leave for family emergencies', 5, true, true), is_activ
NOTICE:  relation "leave_types" already exists, skipping
NOTICE:  relation "leave_balances" already exists, skipping
NOTICE:  relation "leave_requests" already exists, skipping
CREATE TABLE
NOTICE:  relation "salary_advances" already exists, skipping
CREATE TABLE
CREATE TABLE
CREATE TABLE
ERROR:  column "description" of relation "leave_types" does not exist
LINE 56: INSERT INTO leave_types (name, description, max_days_per_yea...
                                        ^
root@superlitecrm:~/isp# ^C
root@superlitecrm:~/isp# docker exec -it isp_crm_db psql -U crm -d isp_crm -c "
ALTER TABLE leave_types ADD COLUMN IF NOT EXISTS description TEXT;
ALTER TABLE leave_types ADD COLUMN IF NOT EXISTS max_days_per_year INTEGER DEFAULT 0;
ALTER TABLE leave_types ADD COLUMN IF NOT EXISTS is_paid BOOLEAN DEFAULT TRUE;
ALTER TABLE leave_types ADD COLUMN IF NOT EXISTS requires_approval BOOLEAN DEFAULT TRUE;

INSERT INTO leave_types (name, max_days_per_year, is_paid, is_active) VALUES
('Annual Leave', 21, true, true),
('Sick Leave', 14, true, true),
('Unpaid Leave', 30, false, true),
('Maternity Leave', 90, true, true),
('Paternity Leave', 14, true, true),
('Compassionate Leave', 5, true, true)
ON CONFLICT DO NOTHING;
"
NOTICE:  column "is_paid" of relation "leave_types" already exists, skipping
ALTER TABLE
NOTICE:  column "requires_approval" of relation "leave_types" already exists, skipping
ALTER TABLE
ALTER TABLE
ALTER TABLE
ERROR:  null value in column "code" of relation "leave_types" violates not-null constraint
DETAIL:  Failing row contains (2, Annual Leave, null, 0, t, t, t, 2025-12-14 13:13:15.865605, null, 21).
root@superlitecrm:~/isp#
